<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sensor Camera with Manual Controls</title>
    <style>
        body {
            font-family: sans-serif;
            background: #111;
            color: white;
            text-align: center;
            padding: 1em;
        }
        video {
            width: 100%;
            max-width: 600px;
            border-radius: 10px;
            margin-bottom: 1em;
        }
        .controls, .sensor-data, .camera-settings {
            margin: 1em auto;
            max-width: 600px;
            background: #222;
            padding: 1em;
            border-radius: 10px;
            text-align: left;
        }
        label {
            display: block;
            margin-top: 1em;
        }
        input[type=range] {
            width: 100%;
        }
    </style>
</head>
<body>
    <h1>üì∏ Sensor Camera</h1>
    <video id="video" autoplay playsinline muted></video>
    <div class="controls">
        <button onclick="capturePhoto()">Capture Photo</button>
    </div>
    <div class="camera-settings" id="cameraControls">
        <h3>üéõÔ∏è Camera Settings</h3>
        <!-- Controls will be added here -->
    </div>
    <div class="sensor-data" id="sensorData">
        <strong>Sensor Data:</strong>
        <pre id="sensorOutput">Waiting for data...</pre>
    </div>
    <canvas id="canvas" style="display:none;"></canvas>

    <script>
        let videoStream;
        let currentSensor = {
            orientation: {},
            position: {}
        };

        async function initCamera() {
            try {
                videoStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                const video = document.getElementById("video");
                video.srcObject = videoStream;
                await video.play();
                initCameraControls();
            } catch (err) {
                alert("Camera error: " + err.message);
            }
        }

        function initCameraControls() {
            const track = videoStream.getVideoTracks()[0];
            const capabilities = track.getCapabilities();
            const cameraControls = document.getElementById("cameraControls");

            function addSlider(name, key) {
                if (!capabilities[key]) return;

                const container = document.createElement("div");
                const label = document.createElement("label");
                label.textContent = `${name}:`;

                const valueSpan = document.createElement("span");
                valueSpan.id = key + "Value";
                valueSpan.textContent = capabilities[key].min;

                const input = document.createElement("input");
                input.type = "range";
                input.min = capabilities[key].min;
                input.max = capabilities[key].max;
                input.step = capabilities[key].step || 1;
                input.value = input.min;
                input.oninput = async () => {
                    valueSpan.textContent = input.value;
                    try {
                        await track.applyConstraints({ advanced: [{ [key]: parseFloat(input.value) }] });
                    } catch (e) {
                        console.warn(`Failed to set ${key}`, e);
                    }
                };

                label.appendChild(valueSpan);
                container.appendChild(label);
                container.appendChild(input);
                cameraControls.appendChild(container);
            }

            addSlider("Zoom", "zoom");
            addSlider("Focus Distance", "focusDistance");
            addSlider("Exposure", "exposureCompensation");
            addSlider("White Balance", "whiteBalance");
        }

        function capturePhoto() {
            const canvas = document.getElementById("canvas");
            const video = document.getElementById("video");
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext("2d");
            ctx.drawImage(video, 0, 0);
            canvas.toBlob(blob => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = `photo_${Date.now()}.jpg`;
                a.click();
                URL.revokeObjectURL(url);
            }, 'image/jpeg');
        }

        function updateSensorOutput() {
            const out = document.getElementById("sensorOutput");
            out.textContent = JSON.stringify(currentSensor, null, 2);
        }

        window.addEventListener("deviceorientation", e => {
            currentSensor.orientation = {
                alpha: e.alpha,
                beta: e.beta,
                gamma: e.gamma
            };
            updateSensorOutput();
        });

        navigator.geolocation.watchPosition(pos => {
            currentSensor.position = {
                latitude: pos.coords.latitude,
                longitude: pos.coords.longitude,
                accuracy: pos.coords.accuracy
            };
            updateSensorOutput();
        }, err => {
            console.warn("GPS error", err);
        }, { enableHighAccuracy: true });

        initCamera();
    </script>
</body>
</html>
