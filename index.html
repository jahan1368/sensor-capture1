<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mobile Camera Controller</title>
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
    }
    video {
      width: 100%;
      max-width: 400px;
      margin: 10px 0;
      background: black;
    }
    select, button, input[type="range"] {
      margin: 5px;
      padding: 5px;
      font-size: 1em;
    }
    .slider-container {
      margin: 10px 0;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    pre {
      background: #222;
      padding: 10px;
      text-align: left;
      overflow-x: auto;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>

  <h1>Mobile Camera Controller</h1>

  <div>
    <label for="cameraSelect">Select Camera:</label>
    <select id="cameraSelect"></select>

    <label for="resolutionSelect">Resolution:</label>
    <select id="resolutionSelect">
      <option value="1920x1080">1920x1080</option>
      <option value="1280x720">1280x720</option>
      <option value="640x480">640x480</option>
    </select>

    <button onclick="startCamera()">Start Camera</button>
  </div>

  <video id="video" autoplay playsinline></video>

  <div id="sliders"></div>

  <h3>Capabilities:</h3>
  <pre id="capabilities"></pre>

  <h3>Sensor Data:</h3>
  <pre id="sensorData"></pre>

  <script>
    let currentStream = null;
    let currentTrack = null;
    let capabilities = {};
    const cameraSelect = document.getElementById('cameraSelect');
    const resolutionSelect = document.getElementById('resolutionSelect');
    const videoEl = document.getElementById('video');
    const slidersDiv = document.getElementById('sliders');
    const capabilitiesEl = document.getElementById('capabilities');
    const sensorDataEl = document.getElementById('sensorData');

    async function enumerateCameras() {
      try {
        // Ask for permission first so labels are available
        await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
      } catch (err) {
        console.error("Permission error:", err);
      }

      const devices = await navigator.mediaDevices.enumerateDevices();
      const videoDevices = devices.filter(d => d.kind === 'videoinput');

      cameraSelect.innerHTML = '';
      videoDevices.forEach((device, index) => {
        const option = document.createElement('option');
        option.value = device.deviceId;
        const label = device.label.toLowerCase();
        if (label.includes("front")) {
          option.text = `Front Camera ${index + 1}`;
        } else if (label.includes("back") || label.includes("rear") || label.includes("environment")) {
          option.text = `Back Camera ${index + 1}`;
        } else {
          option.text = device.label || `Camera ${index + 1}`;
        }
        cameraSelect.appendChild(option);
      });
    }

    async function startCamera() {
      if (currentStream) {
        currentStream.getTracks().forEach(track => track.stop());
      }

      const [width, height] = resolutionSelect.value.split('x').map(Number);
      const constraints = {
        video: {
          deviceId: cameraSelect.value ? { exact: cameraSelect.value } : undefined,
          width: { ideal: width },
          height: { ideal: height }
        },
        audio: false
      };

      try {
        const stream = await navigator.mediaDevices.getUserMedia(constraints);
        videoEl.srcObject = stream;
        currentStream = stream;
        currentTrack = stream.getVideoTracks()[0];
        capabilities = currentTrack.getCapabilities();
        displayCapabilities();
        setupSliderRanges();
      } catch (e) {
        sensorDataEl.textContent = "Camera error: " + e.message;
        console.error('Camera error:', e);
      }
    }

    function displayCapabilities() {
      capabilitiesEl.textContent = JSON.stringify(capabilities, null, 2);
    }

    function setupSliderRanges() {
      slidersDiv.innerHTML = '';
      const settings = currentTrack.getSettings();

      for (const prop in capabilities) {
        if (typeof capabilities[prop] === 'object' &&
            'min' in capabilities[prop] &&
            'max' in capabilities[prop]) {

          const container = document.createElement('div');
          container.className = 'slider-container';

          const label = document.createElement('label');
          label.textContent = `${prop} (${capabilities[prop].min} - ${capabilities[prop].max})`;
          container.appendChild(label);

          const slider = document.createElement('input');
          slider.type = 'range';
          slider.min = capabilities[prop].min;
          slider.max = capabilities[prop].max;
          slider.step = capabilities[prop].step || 1;
          slider.value = settings[prop] || capabilities[prop].min;

          slider.oninput = () => {
            const constraints = {};
            constraints[prop] = slider.value;
            currentTrack.applyConstraints({ advanced: [constraints] });
          };

          container.appendChild(slider);
          slidersDiv.appendChild(container);
        }
      }
    }

    // Init on page load
    enumerateCameras();
  </script>

</body>
</html>
