<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Full Sensor Demo (Web)</title>
<style>
  body {
    font-family: monospace, monospace;
    background: #111;
    color: #eee;
    padding: 1em;
    max-width: 600px;
    margin: auto;
  }
  video {
    width: 100%;
    max-width: 600px;
    border-radius: 8px;
    margin-bottom: 1em;
    background: black;
  }
  pre {
    background: #222;
    padding: 1em;
    border-radius: 8px;
    max-height: 300px;
    overflow-y: auto;
  }
</style>
</head>
<body>

<h1>ðŸ“¡ Full Sensor Demo</h1>

<video id="video" autoplay playsinline muted></video>

<h2>Sensor Data</h2>

<pre id="sensorData">Waiting for sensor data...</pre>

<script>
(async () => {
  const sensorDataEl = document.getElementById("sensorData");
  const videoEl = document.getElementById("video");

  // Show camera video
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
    videoEl.srcObject = stream;
  } catch(e) {
    sensorDataEl.textContent = "Camera error: " + e.message;
  }

  // State to hold sensor values
  const data = {
    deviceOrientation: {},
    deviceMotion: {},
    geolocation: {},
    ambientLight: "N/A",
    magnetometer: "N/A",
    gyroscope: "N/A",
    accelerometer: "N/A"
  };

  // Update display
  function updateDisplay() {
    sensorDataEl.textContent = JSON.stringify(data, null, 2);
  }

  // DeviceOrientationEvent
  window.addEventListener("deviceorientation", e => {
    data.deviceOrientation = {
      alpha: e.alpha?.toFixed(4),
      beta: e.beta?.toFixed(4),
      gamma: e.gamma?.toFixed(4),
      absolute: e.absolute
    };
    updateDisplay();
  });

  // DeviceMotionEvent
  window.addEventListener("devicemotion", e => {
    const acc = e.acceleration;
    const rot = e.rotationRate;
    data.deviceMotion = {
      acceleration: {
        x: acc?.x?.toFixed(4),
        y: acc?.y?.toFixed(4),
        z: acc?.z?.toFixed(4)
      },
      rotationRate: {
        alpha: rot?.alpha?.toFixed(4),
        beta: rot?.beta?.toFixed(4),
        gamma: rot?.gamma?.toFixed(4)
      },
      interval: e.interval
    };
    updateDisplay();
  });

  // Geolocation
  if ("geolocation" in navigator) {
    navigator.geolocation.watchPosition(pos => {
      data.geolocation = {
        latitude: pos.coords.latitude.toFixed(8),
        longitude: pos.coords.longitude.toFixed(8),
        altitude: pos.coords.altitude?.toFixed(2) ?? null,
        accuracy: pos.coords.accuracy.toFixed(2),
        altitudeAccuracy: pos.coords.altitudeAccuracy?.toFixed(2) ?? null,
        heading: pos.coords.heading?.toFixed(2) ?? null,
        speed: pos.coords.speed?.toFixed(2) ?? null,
        timestamp: pos.timestamp
      };
      updateDisplay();
    }, err => {
      data.geolocation = { error: err.message };
      updateDisplay();
    }, { enableHighAccuracy: true, maximumAge: 5000, timeout: 10000 });
  } else {
    data.geolocation = "Geolocation not supported";
  }

  // AmbientLightSensor (experimental)
  if ('AmbientLightSensor' in window) {
    try {
      const als = new AmbientLightSensor();
      als.addEventListener('reading', () => {
        data.ambientLight = als.illuminance.toFixed(2) + " lux";
        updateDisplay();
      });
      als.addEventListener('error', event => {
        data.ambientLight = "Error: " + event.error.name;
        updateDisplay();
      });
      als.start();
    } catch (e) {
      data.ambientLight = "AmbientLightSensor start failed: " + e.message;
    }
  } else {
    data.ambientLight = "AmbientLightSensor not supported";
  }

  // Helper to start generic sensors safely
  async function startSensor(SensorClass, label) {
    if (!(SensorClass in window)) {
      data[label] = label + " not supported";
      updateDisplay();
      return;
    }
    try {
      const sensor = new window[SensorClass]({ frequency: 10 });
      sensor.addEventListener('reading', () => {
        data[label] = {
          x: sensor.x?.toFixed(4),
          y: sensor.y?.toFixed(4),
          z: sensor.z?.toFixed(4)
        };
        updateDisplay();
      });
      sensor.addEventListener('error', event => {
        data[label] = `Error: ${event.error.name}`;
        updateDisplay();
      });
      sensor.start();
    } catch(e) {
      data[label] = `Start failed: ${e.message}`;
      updateDisplay();
    }
  }

  // Start Magnetometer, Gyroscope, Accelerometer
  await startSensor('Magnetometer', 'magnetometer');
  await startSensor('Gyroscope', 'gyroscope');
  await startSensor('Accelerometer', 'accelerometer');

  updateDisplay();
})();
</script>

</body>
</html>
